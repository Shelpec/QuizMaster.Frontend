<div class="container mt-4">
    <h2>User Tests History</h2>
  
    <!-- Два поля для поиска (по userTestId, по email) -->
    <div class="row g-2 mb-3">
      <div class="col-auto">
        <label>UserTestId:</label>
        <input type="number" [(ngModel)]="searchUserTestId" class="form-control" />
      </div>
      <div class="col-auto d-flex align-items-end">
        <button class="btn btn-primary me-3"
                (click)="onSearchById()">
          Search by Id
        </button>
      </div>
  
      <div class="col-auto">
        <label>Email:</label>
        <input type="text" [(ngModel)]="searchEmail" class="form-control" />
      </div>
      <div class="col-auto d-flex align-items-end">
        <button class="btn btn-primary me-3"
                (click)="onSearchByEmail()">
          Search by Email
        </button>
        <button class="btn btn-outline-secondary" 
                (click)="resetSearch()">
          Reset
        </button>
      </div>
    </div>
  
    <!-- Выводим список userTest -->
    <div *ngFor="let item of allUserTests" class="border rounded p-3 mb-3 bg-light">
      <div class="d-flex justify-content-between">
        <div>
          <strong>User:</strong> {{ item.userEmail }} ({{ item.userFullName }}) <br>
          <strong>Test:</strong> {{ item.testName }} 
          (<i>{{ item.topicName || '---' }}</i>), 
          <strong>Questions:</strong> {{ item.testCountOfQuestions }}<br>
          <strong>Correct:</strong> {{ item.correctAnswers }} / {{ item.totalQuestions }} <br>
          <strong>Date:</strong> {{ item.dateCreated }}
        </div>
        <div>
          <!-- Кнопка удаления -->
          <button class="btn btn-sm btn-danger"
                  (click)="deleteUserTest(item)">
            Delete
          </button>
          <!-- Кнопка Expand/Collapse -->
          <button class="btn btn-sm btn-outline-primary ms-2"
                  (click)="toggleExpand(item.userTestId)">
            {{ expanded[item.userTestId] ? 'Hide' : 'Show' }} details
          </button>
        </div>
      </div>
  
      <!-- Детали (questions/answers) -->
      <div *ngIf="expanded[item.userTestId]" class="mt-3">
        <hr>
        <div *ngFor="let q of item.questions" class="mb-2 ps-3">
          <h5>{{ q.questionText }}</h5>
          <div class="ms-3" *ngFor="let ans of q.answers">
            <input type="checkbox"
                   disabled
                   [checked]="ans.isChosen"
                   [ngClass]="getAnswerClass(ans)" />
            <span [ngClass]="getAnswerClass(ans)">
              {{ ans.text }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  